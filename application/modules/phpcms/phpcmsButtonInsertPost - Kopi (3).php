<?php	include ("../phpgeneral/headercheck.php");		require_once(POORBUK_PATH_ABSOLUTE_MODULES.'/phpgeneral/functionsJarim.php');			require_once(POORBUK_PATH_ABSOLUTE_MODULES.'/phpclasses/PostsClass.php');	require_once(POORBUK_PATH_ABSOLUTE_MODULES.'/phpclasses/MenusClass.php');					startConnectionDB();		if (!(isset( $_POST['pUserId'] )) || $_POST['pUserId']==""){exit;}		if (!(isset( $_POST['pWebsiteName'] )) || $_POST['pWebsiteName']==""){exit;}		if (!(isset( $_POST['pTitle'] )) || $_POST['pTitle']==""){exit;}	if (!(isset( $_POST['pUrl'] )) || $_POST['pUrl']==""){exit;}	if (!(isset( $_POST['pTextEditorHTML'] )) ){exit;} 	if (!(isset( $_POST['pHeader'] )) || $_POST['pHeader']==""){exit;}	if (!(isset( $_POST['pMenu'] )) || $_POST['pMenu']==""){exit;} 	if (!(isset( $_POST['pContent'] )) || $_POST['pContent']==""){exit;}	if (!(isset( $_POST['pFooter'] )) || $_POST['pFooter']==""){exit;} 	if (!(isset( $_POST['pType'] )) || $_POST['pType']==""){exit;}	if (!(isset( $_POST['pPublished'] )) || $_POST['pPublished']==""){exit;} 	if (!(isset( $_POST['pCommentAllowed'] )) || $_POST['pCommentAllowed']==""){exit;}	if (!(isset( $_POST['pLoveAllowed'] )) || $_POST['pLoveAllowed']==""){exit;}//CAN BE NULL 	if (!(isset( $_POST['pPass'] )) || $_POST['pPass']==""){exit;}			/*********MENU*************************************/		//echo "the URL exists. Not insert, but update";	if (!(isset( $_POST['mUId'] )) || $_POST['mUId']==""){exit;}	if (!(isset( $_POST['mName'] )) || $_POST['mName']==""){exit;}	if (!(isset( $_POST['mActive'] )) || $_POST['mActive']==""){exit;} 	if (!(isset( $_POST['mPosition'] )) || $_POST['mPosition']==""){exit;}	if (!(isset( $_POST['mType'] )) || $_POST['mType']==""){exit;}	if (!(isset( $_POST['mParent'] )) || $_POST['mParent']==""){exit;}		$pWebId = $_POST['pWebId'];	$pId = $_POST['pId'];	$pWebsiteName = $_POST['pWebsiteName'];	$pUserId = $_POST['pUserId'];	$pTitle = $_POST['pTitle'];	$pUrl = $_POST['pUrl'];		//$pTextEditorHTML= $_POST['pTextEditorHTML'];			//pTextEditorObjectNow.innerHTML =  htmlspecialchars(data);	//$pTextEditorHTML= $_POST['pTextEditorHTML'];	$pTextEditorHTML= $_POST['pTextEditorHTML'];																$pHeader = $_POST['pHeader'];	$pMenu = $_POST['pMenu'];	$pContent = $_POST['pContent'];	$pFooter = $_POST['pFooter'];	$pType = $_POST['pType'];	$pPublished = $_POST['pPublished'];	$pCommentAllowed = $_POST['pCommentAllowed'];	$pLoveAllowed = $_POST['pLoveAllowed'];	$pPass = $_POST['pPass'];		/***************MENUS*************************/			$mUId =$_POST['mUId'];		$mName =$_POST['mName'];	$mParent =$_POST['mParent'];		$mActive = $_POST['mActive'];	$mPosition = $_POST['mPosition'];	$mType =$_POST['mType'];	//echo 	'pId = '.$pId;	//	echo 	'pTextEditorHTML = '.$pTextEditorHTML;			if(!( 			sanityCheckScapeByReference($pTitle, 'string', 200) && 			sanityCheckScapeByReference($pWebsiteName, 'string', 200) && 			sanityCheckScapeByReference($pUrl, 'string', 200) && 			sanityCheckScapeByReference($pHeader, 'string', 200) && 			sanityCheckScapeByReference($pMenu, 'string', 200) && 			sanityCheckScapeByReference($pContent, 'string', 200) && 			sanityCheckScapeByReference($pFooter, 'string', 200) && 			sanityCheckScapeByReference($pType, 'string', 20) && 			sanityCheckScapeByReference($pPublished, 'string', 20) && 			sanityCheckScapeByReference($pCommentAllowed, 'string', 20) && 			sanityCheckScapeByReference($pLoveAllowed, 'string', 20) &&			sanityCheckScapeByReference($mName, 'string', 200) && 			sanityCheckScapeByReference($mParent , 'string', 200) && 						sanityCheckScapeByReference($mActive, 'string', 20) && 			sanityCheckScapeByReference($mType, 'string', 40) 		))	{		echo 'Error sanityCheckScapeByReference phpcmsButtonInsertPost.php';		exit();	}	//echo "<br>mPId = ".$mPId."<br>";		/********MENU CLASS I************************************/$MenuClass = new MenusClass;		/*******POST CLASS************************************/		$PostsClass = new PostsClass;//$lookupPostsByTitleExists = $PostsClass->lookupPostsByTitleExists($pTitle);//	$pUrl = $PostsClass->RenameUrl($pUrl);/*******POST VARIABLES TO MENU VARIABLES TO MAKE IT EASIER*****************************/	$mPId = $pId;//ONLY  FOR UPDATE - SET TO LAST ID INSERT IF INSERT 	$mWebsiteName = $pWebsiteName;	$mUrl = $pUrl;		$lookupIfPostExists =0;//RETURN TRUE IF POST-ID IS FOUNDED if ($pId!=""){	//echo "the URL it's new. Just INSERT";	$lookupIfPostExists = $PostsClass->lookupIfPostExists($pId);			//echo 'lookupIfPostExists ='.$lookupIfPostExists;}	//****UPDATE POSTS AND MENUS**********////if ($lookupIfPostExists) {	//echo "the URL exists. Not insert, but update /  Post Title = $pTitle";	$PostsClass->updatePost($pId,$pWebId,$pWebsiteName,$pUserId,$pTitle,$pUrl,$pTextEditorHTML,$pHeader,$pMenu,$pContent,$pFooter,$pType,$pPublished,$pCommentAllowed,$pLoveAllowed, $pPass);				$MenuClass->updateMenu($mUId,$pWebId,$mPId,$mName,$mParent,$mUrl,$mWebsiteName,$mActive,$mPosition,$mType);	}else{//****INSERT POSTS AND MENUS**********////	/*CHECK IF WEB-ID HAS BEEN POSTED / IF NOT INSERT NEW WEBSITENAME + USER ID*/	if ($pWebId==""  || $pWebId==-1  )	{		//INSERT NEW WEBSITE AND GET WEBSITE-ID 		$pWebId = $PostsClass->insertWeb($pWebsiteName,$pUserId);	}		//echo "the page does not exist. Insert";	//RETURN ID FROM INSERT	$pId= $PostsClass->insertPost( $pWebId,$pWebsiteName,$pUserId,$pTitle,$pUrl,$pTextEditorHTML,$pHeader,$pMenu,$pContent,$pFooter,$pType,$pPublished,$pCommentAllowed,$pLoveAllowed,$pPass);		//SET ID TO LAST INSERTED POST	$mPId = $pId;	$MenuClass->insertMenu($mUId,$pWebId,$mPId,$mName,$mParent,$mUrl,$mWebsiteName,$mActive,$mPosition,$mType);}	/********MENU CLASS II************************************//*1- MAKE THE SQL FOR PARENT MENUS AND FOR CHILD MENUS*/if ($mParent=="NO"){//UPDATE ALL MAIN MENUS	$sql = $MenuClass->showAllMenusMainByUserWebsiteSQL($mUId,$mWebsiteName);}else{//UPDATE ALL CHILD-MENUS (1 LEVEL))	$sql = $MenuClass->showAllSUBMenusForParentIdByUserWebsiteSQL($mParent,$mUId,$mWebsiteName);}/*2- GET ALL MENUS OF THE SAME TYPE(PARENT OR CHILD) INTO ARRAY  *///$allMenusArray = $MenuClass->showAllMenusByUserIdAndWebsiteNameArray($sql);$allMenusArray = $MenuClass->show_AllMenus_By_WebsiteId_Array($sql);/*3- REORDER ALL MENUS USING ARRAYS*/$MenuClass->updateAllMenus($allMenusArray,$mPId,$mUId,$mPosition,$mWebsiteName);/*DESACTIVADO TEMPORALMENTE PORQUE LA FUNCION showAllMenusByUserIdAndWebsiteNameArray DESPARECIO */$PostsClass->convert_pId_pWebId_Json($pId,$pWebId);/***********TESTER******************************//*echo "	Title = $pTitle 	pTextEditorHTML = mysqli_real_escape_string_jarim_ByReference(nl2br($pTextEditorHTML)) 	pHeader = $pHeader 	pMenu = $pMenu 	pContent = $pContent 	pFooter = $pFooter 	pType = $pType 	pPublished = $pPublished 	pCommentAllowed = $pCommentAllowed 	pLoveAllowed = $pLoveAllowed 	pass = $pPass ";*//***********END TESTER******************************/?>	